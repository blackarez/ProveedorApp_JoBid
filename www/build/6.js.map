{"version":3,"sources":["../../src/pages/service-sale/service-sale.module.ts","../../src/pages/service-sale/service-sale.ts"],"names":[],"mappings":"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","file":"6.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { ServiceSalePage } from './service-sale';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    ServiceSalePage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(ServiceSalePage),\r\n  ],\r\n})\r\nexport class ServiceSalePageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/service-sale/service-sale.module.ts","import { Component } from '@angular/core';\r\nimport { IonicPage, NavController, NavParams,AlertController,Platform} from 'ionic-angular';\r\n\r\nimport { ProfessionalsService } from '../../services/professionals.service';\r\nimport { SaleService } from '../../services/sale.service';\r\n// import { OfferService } from '../../services/offer.service';\r\n\r\n\r\n// import { Geolocation } from '@ionic-native/geolocation';\r\n\r\n/**\r\n * Generated class for the ServiceSalePage page.\r\n *\r\n * See https://ionicframework.com/docs/components/#navigation for more info on\r\n * Ionic pages and navigation.\r\n */\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-service-sale',\r\n  templateUrl: 'service-sale.html',\r\n})\r\nexport class ServiceSalePage {\r\n  //-data\r\n  DataService:any=[];\r\n  userActual:any;\r\n  newOffer:any;\r\n  \r\n  //--valiables por defecto provider\r\n  imgJobDefault =\"assets/img/professions/cleaning.png\";\r\n  galleryJobDefault =\"assets/img/gallery.png\";\r\n  //-final offer\r\n  MenosPrecio:any;\r\n  //--sale\r\n  maxOffer:any;\r\n  myOffer:any;\r\n\r\n  dataOffer:any;\r\n  keyOffer:any;\r\n\r\n  Workers:any=[];\r\n  WorkersInfo:any=[];\r\n  dataService:any;\r\n  //--datas\r\n\r\n  professionals = [];\r\n  professsional = [];\r\n  //--timer\r\n  segundos:number = 0;\r\n  minutos:number = 2;\r\n  contador:string;\r\n  showContador: boolean = true;\r\n  objNodeTimer:any;\r\n  //-- geoLocation\r\n  lat: number= 37.09024;\r\n  lng: number= -95.71289100000001;\r\n  zom: number = 16;\r\n\r\n  constructor(\r\n    public navCtrl: NavController, \r\n    public navParams: NavParams,\r\n    public alertCtrl: AlertController,\r\n    public professionalsService : ProfessionalsService,\r\n    // private geo: Geolocation, private platform: Platform,\r\n    private saleService: SaleService,  \r\n    // private offerService: OfferService,  \r\n  ) {\r\n      this.contador = '0'+this.minutos+':'+'0'+this.segundos;\r\n      this.startTimer();\r\n      this.DataService = this.navParams.get('datos');\r\n      console.log(this.DataService);\r\n      console.log(localStorage);\r\n      this.userActual= localStorage.getItem('verificacion');\r\n      this.loadView();\r\n      this.getUserLocationGeolocation();\r\n      this.getSale();\r\n    }\r\n    \r\n  ionViewDidLoad() {\r\n    console.log('ionViewDidLoad ServiceSalePage');\r\n}\r\n\r\nloadView(){\r\n  this.maxOffer = this.DataService.sale;\r\n}\r\n\r\nnewOfferProvider(){\r\n  if(this.MenosPrecio > Number(this.newOffer) ){\r\n    this.saleService.setSaleProvider(this.DataService.idUser,this.DataService.idOff,this.userActual,this.newOffer);\r\n    this.myOffer =  Number(this.newOffer);\r\n  }else{\r\n    alert('The offer must be less than the current');\r\n  }\r\n  // this.navCtrl.setRoot('ServiceWinPage');\r\n}\r\n\r\ndetailsService(){\r\n  let description = '<img src=\"assets/img/User/FotoServiceInfo.JPG\"  class=\"imageFull\"/><p>'+this.DataService.info+'</p>';\r\n  let alert = this.alertCtrl.create({\r\n    title: 'Service Information',\r\n\r\n    message: description,\r\n    buttons: ['OK']\r\n  });\r\n  alert.present();\r\n}\r\n\r\n// goCleaningContractor(ganador?){\r\ngoCleaningContractor(){\r\n  // console.info('goCleaningContractor');\r\n  // console.log(ganador);\r\n  // let DataService = {'datos':{\"dataService\":this.dataService,\"offer\":this.keyOffer,\"win\":ganador}};\r\n  // console.log(DataService);\r\n  // this.navCtrl.setRoot('ServiceWinPage',DataService);\r\n  this.navCtrl.setRoot('ServiceWinPage');\r\n}\r\n\r\ngoIndex(){\r\n  \r\n//--set status offer y sale\r\n// console.info('Offer -Cancelled');\r\n// this.saleService.setStatus(this.userActual,this.keyOffer,'Cancelled');\r\n// this.offerService.setStatus(this.keyOffer,'Cancelled');\r\n//   clearInterval(this.objNodeTimer);\r\n  this.navCtrl.setRoot('ShowPage');\r\n}\r\n\r\n\r\n//--- timer\r\nstartTimer(){\r\n  this.objNodeTimer=setInterval( () => this.timer(),1000);\r\n}\r\n\r\nprivate timer(){\r\n  if(this.minutos == 0 && this.segundos == 1){ \r\n  // if(this.minutos == 1 && this.segundos == 40 ){ \r\n    //this.showContador = false;\r\n      clearInterval(this.objNodeTimer);\r\n       this.showContador = false;\r\n       this.ganador();\r\n  }else{\r\n    if(--this.segundos< 0){\r\n      this.segundos = 59;\r\n      if(--this.minutos< 0){\r\n        //this.minutos = 59;\r\n        //if( (this.segundos = 0) && (this.minutos = 0)){ this.showContador = false;}\r\n      }\r\n    }\r\n    this.contador = this.dobleCifra(this.minutos)+':'+this.dobleCifra(this.segundos);\r\n  }\r\n}\r\n\r\n//--- Functions\r\n\r\nasync getSale(){\r\n  this.MenosPrecio= undefined;\r\n  let finRegistro:boolean= false;\r\n  console.log(this.DataService.idOff);\r\n  console.log(this.DataService.idUser);\r\n  this.saleService.getSale(this.DataService.idUser,this.DataService.idOff)\r\n  .subscribe((result) =>{\r\n    this.Workers = [];\r\n    this.WorkersInfo =[];\r\n    this.MenosPrecio = undefined;\r\n    console.log(result);\r\n    //console.log(result.sale);\r\n    //console.log(result.providers);\r\n    if(this.MenosPrecio ==  undefined){\r\n      this.MenosPrecio = Number(result.sale);\r\n    }\r\n    let trabajadores = result.providers;\r\n    for(let trabajador in trabajadores){\r\n      // console.log(trabajadores);\r\n      // console.log(trabajadores[trabajador]);\r\n      //console.log(trabajadores[trabajador]['offer']);\r\n      // console.log(trabajador);\r\n      if(this.MenosPrecio > Number(trabajadores[trabajador]['offer']) ) { this.MenosPrecio= Number(trabajadores[trabajador]['offer']);}\r\n      let PromiseUser =this.professionalsService.getProfessional(trabajador);\r\n      // console.log(PromiseUser);\r\n      PromiseUser.subscribe((user) =>{\r\n        //console.log(user);\r\n        this.WorkersInfo.push(user);\r\n        let img = this.imgJobDefault;\r\n        if(user.prof_picture && user.prof_picture != undefined && user.prof_picture != ''){\r\n          img = user.prof_picture;\r\n        }\r\n        this.Workers.push({\"id\":trabajador,\"offer\":trabajadores[trabajador]['offer'],\"img\":img,\"name\":user.prof_name});\r\n      });\r\n    }\r\n    finRegistro = true;\r\n    console.log(this.Workers);\r\n    console.log(this.WorkersInfo);\r\n    console.log(this.MenosPrecio);\r\n    let estadoUser= this.Workers;\r\n    console.log(estadoUser);\r\n    // for(let jobs in estadoUser){\r\n    //   console.log('jobs');\r\n    //   console.log(jobs);\r\n    //   console.log(estadoUser[jobs]);\r\n    // }\r\n    // console.log('verifcar la informacion');\r\n\r\n  });\r\n  \r\n}\r\n\r\nganador(){\r\n  if(this.MenosPrecio == this.myOffer){\r\n    this.goCleaningContractor();\r\n  }else{\r\n    this.navCtrl.setRoot('ShowPage');\r\n  }\r\n}\r\n\r\nprivate dobleCifra(num:number):any{\r\n  if(num<10){ return '0'+num;\r\n  }else{ return ''+num;}\r\n}\r\n\r\n\r\nprivate getUserLocationGeolocation(){\r\n  // this.platform.ready().then(() => {\r\n  //   let options = {\r\n  //     timeout: 5000\r\n  //   };\r\n  //   this.geo.getCurrentPosition(options).then(resp => {\r\n  //     console.log('geoLocation');\r\n  //     console.info(resp.coords.latitude);\r\n  //     console.info(resp.coords.longitude);\r\n  //     this.lat = resp.coords.latitude;\r\n  //     this.lng = resp.coords.longitude;\r\n  //   }).catch(() => {\r\n  //     console.log(\"Error to get location\");\r\n  //   });\r\n  // });\r\n}\r\n\r\n\r\n}\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/service-sale/service-sale.ts"],"sourceRoot":""}